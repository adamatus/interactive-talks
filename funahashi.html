<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
    <link type="text/css" rel="stylesheet" href="css/slide.css">
    <link type="text/css" rel="stylesheet" href="css/charts.css">
    <link type="text/css" rel="stylesheet" href="css/button.css">
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/my-slide.js"></script>
    <style>
.chart {
    display: none;
}
    </style>
  </head>
  <body>
    <div id="slide">
      <div id="header">
          <h1></h1>
      </div>
      <div id="content-frame" class='with-only-foot'>
          <div id="content">
              <img class='step' src='media/monkey_mgs_task.png' style="width: 900px; height: auto;">
              <img id='fef' class='step' src='media/monkey_fef_recording.png' style="width: 400px; height: auto; display: none;">
              <!-- CHART INSERTED HERE -->
          </div>
      </div>
      <div id="footer">
          <h2>Funahashi et al. (1989) J Neurophys</h2>
      </div>
      <script type="text/javascript">

var width = 900;
    height = 650;

var margins = [80, 100, 100, 30], mb = margins[0], ml = margins[1], mt = margins[2], mr = margins[3];
var w = width - (ml + mr),
    h = height - (mb + mt);
var x = d3.scale.linear().range([0, w]).domain([0,10]);
var y = d3.scale.linear().range([h, 0]).domain([0,18]);
var yAxis = d3.svg.axis().scale(y).ticks(4).orient("left");
var xAxis = d3.svg.axis().scale(x).ticks(5);
var yAxisGrid = d3.svg.axis().scale(y).ticks(4).tickSize(-w).orient("right");

var svg = d3.select('#content').append('svg:svg')
    .attr('class', 'chart step')
    .attr("width", width)
    .attr("height", height);

var plot = svg.append('g').attr('id','plot').attr('transform','translate('+ml+','+mt+')');

var dataRegion = plot.append('g').attr('id','data-region');

d3.csv('data/funahashi.csv',function(d) {
    plot.selectAll('.data-rect')
            .data(d)
        .enter()
            .append('svg:rect')
                .classed('data-rect',true)
                .attr('width',6)
                .attr('height',function(d) { return h-y(d.y); })
                .attr('x',function(d) { return x(d.x)+1; })
                .attr('y',function(d) { return y(d.y)-1; })
                .style('fill','#999')
                .on('mouseover',function(d,i) {
                    d3.selectAll('.data-rect')
                        .filter(function(d,j) { 
                            if (i < 28) {
                                return j < 28;
                            } else if ( i < 43 ) {
                                return j > 27 && j < 43;
                            } else if (i < 107){
                                return j > 41 && j < 107;
                            } else {
                                return j >=106;
                            }
                         })
                        .transition()
                        .duration(300)
                        .ease('linear')
                        .style('fill','red');
                        })
                .on('mouseout',function(d,i) {
                    d3.selectAll('.data-rect')
                        .transition()
                        .duration(300)
                        .ease('linear')
                        .style('fill','#999');
                        })
                ;

            // Add y-axis
            plot.append("g")
                  .attr("class", "y axis")
                  .call(yAxis);
            plot.select('.y.axis').append('svg:text')
                .attr('id','ylab')
                .text('Spikes Per Second')
                .style('text-anchor','middle')
                .attr('transform','translate(-65,'+(h/2)+') rotate(-90)');

            // Add x-axis
            plot.append("g")
                  .attr("class", "x axis")
                  .attr('transform','translate(0,'+h+') ')
                  .call(xAxis);
            //plot.append('svg:line')
            //        .attr('x2',w)
            //        .attr('y1',h)
            //        .attr('y2',h);
            plot.select('.x.axis').append('svg:text')
                .text('Trial Time (s)').style('text-anchor','middle')
                .attr('transform','translate('+(w/2)+','+70+') ');

            plot.append('svg:line')
                .attr('id','target-line')
                .attr('x1',x(2))
                .attr('x2',x(2))
                .attr('y1',y(0))
                .attr('y2',y(18))
                .style('stroke','black')
                .style('stroke-dasharray','5,5')
                .style('stroke-width','3px');
            plot.append('svg:line')
                .attr('id','target-line')
                .attr('x1',x(3))
                .attr('x2',x(3))
                .attr('y1',y(0))
                .attr('y2',y(18))
                .style('stroke','black')
                .style('stroke-dasharray','5,5')
                .style('stroke-width','3px');
            plot.append('svg:line')
                .attr('id','target-line')
                .attr('x1',x(7.5))
                .attr('x2',x(7.5))
                .attr('y1',y(0))
                .attr('y2',y(18))
                .style('stroke','black')
                .style('stroke-dasharray','5,5')
                .style('stroke-width','3px');
            plot.selectAll('.labels').data([{x:2.5,label:'Target'},{x:5.5,label:'Delay'},{x:8,label:'Response'}]).enter().append('svg:text')
                .text(function(d) { return d.label; })
                .attr('x',function(d) { return x(d.x); })
                .attr('y',-40);
            plot.append('svg:line')
                .attr('id','baseline-line')
                .attr('x1',x(0))
                .attr('x2',x(10))
                .attr('y1',y(7))
                .attr('y2',y(7))
                .style('opacity',0)
                .style('stroke','#444')
                .style('stroke-dasharray','10,10')
                .style('stroke-width','2px');
});

var step = 0;
var maxStep = 3;

d3.selectAll('.step').data(d3.range(3));

var update = function() {
    if (step == 0) {
        d3.selectAll('.step').filter(function(d,i) { return i == 0; })
            .transition().duration(1000).style('display','inline');
        d3.selectAll('.step').filter(function(d,i) { return i != 0; })
            .transition().duration(1000).style('display','none');
    } else if (step == 1) {
        d3.selectAll('.step').filter(function(d,i) { return i != 2; })
            .transition().duration(1000).style('display','inline');
        d3.selectAll('.step').filter(function(d,i) { return i == 2; })
            .transition().duration(1000).style('display','none');
    } else if (step == 2) {
        d3.selectAll('.step').filter(function(d,i) { return i != 2; })
            .transition().duration(1000).style('display','none');
        d3.selectAll('.step').filter(function(d,i) { return i == 2; })
            .transition().duration(1000).style('display','inline');
        d3.select('#baseline-line').transition().duration(500).style('opacity',0);
    } else {
        d3.select('#baseline-line').transition().duration(500).style('opacity',1);

    }
}

var down = function() {
    step = step < maxStep ? step+1 : maxStep;
    update();
}

var up = function() {
    step = step > 0 ? step-1 : 0;
    update();
}
      </script>
    </div>
  </body>
</html>
