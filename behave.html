<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="contrib/bootstrap/css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="contrib/bootstrap/css/bootstrap-theme.min.css">
    <link type="text/css" rel="stylesheet" href="css/slide.css">
    <link type="text/css" rel="stylesheet" href="css/charts.css">
    <script type="text/javascript" src="contrib/d3/d3.v3.min.js"></script>
    <script type="text/javascript" src="contrib/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="js/my-slide.js"></script>
  </head>
  <body>
    <div id="slide">
      <div id="header">
          <h1>Behavioral Performance</h1>
      </div>
      <div id="content-frame" class='with-only-head'>
        <div id="content">
          <div id="chart"></div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
// TODO Add legend
// TODO Add mean
// TODO Add ability to chance order
var i;
var myd = [];
var mags = [-45,-20,-7,7,20,45];

d3.text('data/summary_cw.1d', function(d) {
    d = d.split('\n');
    myd.push({load: 1, col: '#2171B5', vals: d[1].split(' ').slice(1)});
    myd.push({load: 2, col: '#6BAED6', vals: d[2].split(' ').slice(1)});
    myd.push({load: 3, col: '#BDD7E7', vals: d[3].split(' ').slice(1)});

    d3.text('data/summary_cw_sd.1d', function(dd) {
      dd = dd.split('\n');
      myd[0].sds = dd[1].split(' ').splice(1);
      myd[1].sds = dd[2].split(' ').splice(1);
      myd[2].sds = dd[3].split(' ').splice(1);

      d3.text('data/fits_cw.1d', function(dd) {
        dd = dd.split('\n');
        myd[0].fit_b0 = +dd[1].split(' ')[1];
        myd[0].fit_b1 = +dd[1].split(' ')[2];
        myd[1].fit_b0 = +dd[2].split(' ')[1];
        myd[1].fit_b1 = +dd[2].split(' ')[2];
        myd[2].fit_b0 = +dd[3].split(' ')[1];
        myd[2].fit_b1 = +dd[3].split(' ')[2];

        addLines();
      })
    })
});

var padding = 40,
    width = 900,
    height = 450,
    started = false;

var margins = [50, 250, 10, 150],
    mb = margins[0],
    ml = margins[1],
    mt = margins[2],
    mr = margins[3],
    w = width - (ml + mr),
    h = height - (mb + mt);

var x = d3.scale.linear()
  .domain([-50, 50])
  .range([0, w]);
var y = d3.scale.linear()
  .domain([0,1])
  .rangeRound([h, 0]);

var xAxis = d3.svg.axis().scale(x).ticks(10).orient("bottom");
var yAxis = d3.svg.axis().scale(y).ticks(5).orient("left");

var lineDemo = d3.select("#chart")
  .append("svg:svg")
  .attr("width", width)
  .attr("height", height+padding);

var plot = lineDemo.append('g')
  .attr('id','plot')
  .attr('transform','translate('+ml+','+mt+')');

// Add y-axis
var x_axis = plot.append("g")
  .attr("class", "x axis")
  .attr('transform','translate(0,'+h+')');
x_axis.append('svg:text')
  .text('Magnitude of change (degrees)')
  .attr('transform','translate('+x(0)+',80)');
x_axis.call(xAxis);

// Add y-axis
var y_axis = plot.append("g")
  .attr("class", "y axis")
y_axis.append('svg:text')
  .text('Proportion')
  .style('text-anchor','middle')
  .attr('transform','translate(-140,'+y(.6)+')');
y_axis.append('svg:text')
  .text('of clockwise')
  .style('text-anchor','middle')
  .attr('transform','translate(-140,'+y(.5)+')');
y_axis.append('svg:text')
  .text('responses')
  .style('text-anchor','middle')
  .attr('transform','translate(-140,'+y(.4)+')');
y_axis.call(yAxis);

var plotgroup = plot.append('g')
  .attr('class','plot-group');

var line = d3.svg.line()
  .interpolate('basis-open')
  .x(function(d,i) { return x(d.x); })
  .y(function(d) { return y(d.y); });

// Add quandrant dividers

plotgroup.append('svg:line')
  .attr('class','chance-line')
  .attr('x1',x(0))
  .attr('x2',x(0))
  .attr('y1',y(0))
  .attr('y2',y(1));

plotgroup.append('svg:line')
  .attr('class','chance-line')
  .attr('x1',x(-50))
  .attr('x2',x(50))
  .attr('y1',y(.5))
  .attr('y2',y(.5));


var sigmoid = function (b0,b1,x) {
  return 1/(1+Math.exp(-(b0+b1*x)));
};

y_axis.call(yAxis);

var plotgroup = plot.append('g')
  .attr('class','plot-group');

var line = d3.svg.line()
  .interpolate('monotone')
  .x(function(d,i) { return x(d.x); })
  .y(function(d) { return y(d.y); });

// Add quandrant dividers

plotgroup.append('svg:line')
  .attr('class','chance-line')
  .attr('x1',x(0))
  .attr('x2',x(0))
  .attr('y1',y(0))
  .attr('y2',y(1));

plotgroup.append('svg:line')
  .attr('class','chance-line')
  .attr('x1',x(-50))
  .attr('x2',x(50))
  .attr('y1',y(.5))
  .attr('y2',y(.5));


var sigmoid = function (b0,b1,x) {
  return 1/(1+Math.exp(-(b0+b1*x)));
};

//var xs = d3.range(101).map(function(d) { return (d-50);});
var xs = d3.range(-50,50,2.5);
//var xs = d3.range(1001).map(function(d) { return (d-500)/10;});

var addLines = function() {
  var data_group = plotgroup.selectAll('g.data-group')
      .data(myd)
    .enter().append('g')
      .style('stroke',function(d) { return d.col; })
      .style('fill',function(d) { return d.col; })
      .attr('class','data-group');

  data_group.selectAll('se.data')
    .data(function(d) {
        var out = [];
        for (var i=0; i < d.vals.length; i++) {
          out.push({y: +d.vals[i], se: +d.sds[i]/Math.sqrt(8)});
        }
        return out;
      })
    .enter().append('svg:line')
      .attr('class','data')
      .style('stroke-width','6px')
      .attr('y1',function(d) { return y(d.y + d.se); })
      .attr('y2',function(d) { return y(d.y - d.se); })
      .attr('x1',function(d,i) { return x(mags[i]); })
      .attr('x2',function(d,i) { return x(mags[i]); });

  data_group.selectAll('circle.data')
      .data(function(d) { return d.vals; })
    .enter().append('svg:circle')
      .style('fill',function(d) {return d.col;})
      .attr('class','data')
      .attr('r',8)
      .attr('cy',function(d) { return y(d); })
      .attr('cx',function(d,i) { return x(mags[i]); });

  data_group.append('svg:path')
    .attr('d',function(d) {
        var out = []
        for (var i=0; i< xs.length; i++) {
          out.push({
            x: xs[i],
            y: sigmoid(d.fit_b0,d.fit_b1,xs[i])
          });
        }
        return line(out);
    })
    .style('fill','none')
    .attr('class','fit');

  var legend_groups = data_group.append('svg:g')
    .attr('class','legend-group');

  legend_groups.append('svg:circle')
    .attr('cx',x(32.5))
    .attr('cy',function(d,i) { return y(i/15+.05); })
    .attr('r',8)
    .style('fill',function(d) {return d.col;})
    .attr('stroke',function(d) { return d.col; })
    .attr('class','legend-dot');

  legend_groups.append('svg:line')
    .attr('x1',x(30))
    .attr('x2',x(35))
    .style('stroke-width','6px')
    .attr('y1',function(d,i) { return y(i/15+.05); })
    .attr('y2',function(d,i) { return y(i/15+.05); })
    .attr('stroke',function(d) { return d.col; })
    .attr('class','legend-line');

  legend_groups.append('svg:text')
    .text(function(d,i) { return 'Load ' + (i+1);})
    .attr('x',x(43))
    .attr('y',function(d,i) { return y(i/15+.025); });

  data_group.style('opacity',0);
}

var step = 0;
var maxStep = 4;

var update = function() {
  var data_group = plotgroup.selectAll('g.data-group');

  if (step == 0) {
    data_group.style('opacity',0);
  } else if (step == 1) {
    data_group.filter(function(d,i) { return i != 0;}).style('opacity',0);
    data_group.filter(function(d,i) { return i == 0;}).style('opacity',1);
    data_group.selectAll('path').style('opacity',0);
  } else if (step == 2) {
    data_group.filter(function(d,i) { return i != 0;}).style('opacity',0);
    data_group.filter(function(d,i) { return i == 0;}).style('opacity',1);
    data_group.selectAll('path').style('opacity',1);
  } else if (step == 3) {
    data_group.filter(function(d,i) { return i != 2;}).style('opacity',1);
    data_group.filter(function(d,i) { return i == 2;}).style('opacity',0);
  } else {
    data_group.style('opacity',1);
  }
};

var down = function down() {
  step = step < maxStep ? step+1 : maxStep;
  update();
};

var up = function up() {
  step = step > 0 ? step-1 : 0;
  update();
};

update();
    </script>
    <script type="text/javascript" src="contrib/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>
