<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="css/slide.css">
    <link type="text/css" rel="stylesheet" href="css/colorbrewer.css">
    <link type="text/css" rel="stylesheet" href="css/button.css">
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <style>
#play {
    padding-left: 200px;
}
</style>
  </head>
  <body>
    <div id="body">
      <div id="header">
         Pattern Classification
      </div>
      <div id="chart">
      </div>
      <script type="text/javascript">

var width = 800;
    height = 600;

var grid_y = d3.scale.linear().range([150, 550]).domain([0,15]);
var grid_x = d3.scale.linear().range([50, 500]).domain([0,15]);

var input_y = d3.scale.linear().range([150, 550]).domain([0,15]);
var output_y = d3.scale.linear().range([200, 500]).domain([0,7]);
var x = d3.scale.linear().range([0,750]).domain([0,20]);

var col = d3.scale.quantize().range(d3.range(9).reverse()).domain([-2,2]);

var svg = d3.select('#chart').append('svg:svg')
    .attr('class', 'chart')
    .style('background','rgb(128,128,128)')
    .attr("width", width)
    .attr("height", height);

var nd = [];

var grid = svg.append('svg:g')
    .attr('id','grid');

var trials = [];
var voxels = [];
d3.csv('data/train_pat_small.csv',function(d) {
        trials = grid.selectAll('.trial')
            .data(d)
            .enter().append('svg:g')
            .attr('class','trial PuOr')
            .attr('transform',function(d,i) { return 'translate('+grid_x(i)+',0)';});

        trials.selectAll('.voxels').data(function(d,i) { 
            console.log(d); 
            var tmp=[];
            for(var i = 0; i < 16; i++) tmp.push(parseFloat(d[i]));
            return tmp; })
            .enter().append('svg:rect')
                .attr('width',20)
                .attr('height',20)
                .attr('x',-10)
                .attr('y',function(d,i) { return grid_y(i)-10; })
                .attr('class',function(d) { return "voxel q"+col(d)+"-9"; } )
                .style('stroke','black');

        });

    

var network = svg.append('svg:g')
    .attr('id','full-network');

var weights = [
{map: [{input: 0, output: 0, weight: 1},
       {input: 1, output: 0, weight: 1},
       {input: 2, output: 0, weight: 1},
       {input: 3, output: 0, weight: 1},
       {input: 4, output: 0, weight: 1},
       {input: 5, output: 0, weight: 1},
       {input: 6, output: 0, weight: 1},
       {input: 7, output: 0, weight: 1},
       {input: 8, output: 0, weight: 1},
       {input: 9, output: 0, weight: 1},
       {input: 10, output: 0, weight: 1},
       {input: 11, output: 0, weight: 1},
       {input: 12, output: 0, weight: 1},
       {input: 13, output: 0, weight: 1},
       {input: 14, output: 0, weight: 1},
       {input: 15, output: 0, weight: 1},
]},
{map: [{ input: 0, output: 1, weight: 1},
       { input: 1, output: 1, weight: 1},
       { input: 2, output: 1, weight: 1},
       { input: 3, output: 1, weight: 1},
       { input: 4, output: 1, weight: 1},
       { input: 5, output: 1, weight: 1},
       { input: 6, output: 1, weight: 1},
       { input: 7, output: 1, weight: 1},
       { input: 8, output: 1, weight: 1},
       { input: 9, output: 1, weight: 1},
       {input: 10, output: 1, weight: 1},
       {input: 11, output: 1, weight: 1},
       {input: 12, output: 1, weight: 1},
       {input: 13, output: 1, weight: 1},
       {input: 14, output: 1, weight: 1},
       {input: 15, output: 1, weight: 1},
]},
{map: [{ input: 0, output: 2, weight: 1},
       { input: 1, output: 2, weight: 1},
       { input: 2, output: 2, weight: 1},
       { input: 3, output: 2, weight: 1},
       { input: 4, output: 2, weight: 1},
       { input: 5, output: 2, weight: 1},
       { input: 6, output: 2, weight: 1},
       { input: 7, output: 2, weight: 1},
       { input: 8, output: 2, weight: 1},
       { input: 9, output: 2, weight: 1},
       {input: 10, output: 2, weight: 1},
       {input: 11, output: 2, weight: 1},
       {input: 12, output: 2, weight: 1},
       {input: 13, output: 2, weight: 1},
       {input: 14, output: 2, weight: 1},
       {input: 15, output: 2, weight: 1},
]},
{map: [{ input: 0, output: 3, weight: 1},
       { input: 1, output: 3, weight: 1},
       { input: 2, output: 3, weight: 1},
       { input: 3, output: 3, weight: 1},
       { input: 4, output: 3, weight: 1},
       { input: 5, output: 3, weight: 1},
       { input: 6, output: 3, weight: 1},
       { input: 7, output: 3, weight: 1},
       { input: 8, output: 3, weight: 1},
       { input: 9, output: 3, weight: 1},
       {input: 10, output: 3, weight: 1},
       {input: 11, output: 3, weight: 1},
       {input: 12, output: 3, weight: 1},
       {input: 13, output: 3, weight: 1},
       {input: 14, output: 3, weight: 1},
       {input: 15, output: 3, weight: 1},
]},
{map: [{ input: 0, output: 4, weight: 1},
       { input: 1, output: 4, weight: 1},
       { input: 2, output: 4, weight: 1},
       { input: 3, output: 4, weight: 1},
       { input: 4, output: 4, weight: 1},
       { input: 5, output: 4, weight: 1},
       { input: 6, output: 4, weight: 1},
       { input: 7, output: 4, weight: 1},
       { input: 8, output: 4, weight: 1},
       { input: 9, output: 4, weight: 1},
       {input: 10, output: 4, weight: 1},
       {input: 11, output: 4, weight: 1},
       {input: 12, output: 4, weight: 1},
       {input: 13, output: 4, weight: 1},
       {input: 14, output: 4, weight: 1},
       {input: 15, output: 4, weight: 1},
]},
{map: [{ input: 0, output: 5, weight: 1},
       { input: 1, output: 5, weight: 1},
       { input: 2, output: 5, weight: 1},
       { input: 3, output: 5, weight: 1},
       { input: 4, output: 5, weight: 1},
       { input: 5, output: 5, weight: 1},
       { input: 6, output: 5, weight: 1},
       { input: 7, output: 5, weight: 1},
       { input: 8, output: 5, weight: 1},
       { input: 9, output: 5, weight: 1},
       {input: 10, output: 5, weight: 1},
       {input: 11, output: 5, weight: 1},
       {input: 12, output: 5, weight: 1},
       {input: 13, output: 5, weight: 1},
       {input: 14, output: 5, weight: 1},
       {input: 15, output: 5, weight: 1},
]},
{map: [{ input: 0, output: 6, weight: 1},
       { input: 1, output: 6, weight: 1},
       { input: 2, output: 6, weight: 1},
       { input: 3, output: 6, weight: 1},
       { input: 4, output: 6, weight: 1},
       { input: 5, output: 6, weight: 1},
       { input: 6, output: 6, weight: 1},
       { input: 7, output: 6, weight: 1},
       { input: 8, output: 6, weight: 1},
       { input: 9, output: 6, weight: 1},
       {input: 10, output: 6, weight: 1},
       {input: 11, output: 6, weight: 1},
       {input: 12, output: 6, weight: 1},
       {input: 13, output: 6, weight: 1},
       {input: 14, output: 6, weight: 1},
       {input: 15, output: 6, weight: 1},
]},
{map: [{ input: 0, output: 7, weight: 1},
       { input: 1, output: 7, weight: 1},
       { input: 2, output: 7, weight: 1},
       { input: 3, output: 7, weight: 1},
       { input: 4, output: 7, weight: 1},
       { input: 5, output: 7, weight: 1},
       { input: 6, output: 7, weight: 1},
       { input: 7, output: 7, weight: 1},
       { input: 8, output: 7, weight: 1},
       { input: 9, output: 7, weight: 1},
       {input: 10, output: 7, weight: 1},
       {input: 11, output: 7, weight: 1},
       {input: 12, output: 7, weight: 1},
       {input: 13, output: 7, weight: 1},
       {input: 14, output: 7, weight: 1},
       {input: 15, output: 7, weight: 1},
]},

];

var connections = network.append('svg:g').attr('id','connections');
var output_connections = connections.selectAll('.output-weights')
.data(weights)
    .enter()
    .append('svg:g')
    .attr('class','output-weights');

var lines = output_connections.selectAll('.weight-lines')
    .data(function(d,i) { return d.map;})
        .enter()
        .append('svg:line')
        .attr('y1',function(d,i) {return input_y(d.input);})
        .attr('x1',x(15))
        .attr('y2',function(d,i) {return output_y(d.output);})
        .attr('x2',x(20))
        .style('opacity',function(d) { return d.weight; });

var input_layer = network.append('svg:g').attr('id','input-layer');
var input_units = input_layer.selectAll('.input-node')
.data(d3.range(16))
    .enter()
    .append('svg:g')
        .attr('class','input-node')
        .attr('transform',function(d,i) { return 'translate('+x(15)+','+input_y(i)+')'; });

input_units.append('svg:rect')
    .attr('width',20)
    .attr('height',20)
    .attr('x',-10)
    .attr('y',-10)
    .style('fill','white')
    .style('stroke','black');

var output_layer = network.append('svg:g').attr('id','output-layer');
var output_units = output_layer.selectAll('.output-node')
.data(d3.range(8))
    .enter()
    .append('svg:g')
        .attr('class','output-node')
        .attr('transform',function(d,i) { return 'translate('+x(20)+','+output_y(i)+')'; });

output_units.append('svg:rect')
    .attr('width',20)
    .attr('height',20)
    .attr('x',-10)
    .attr('y',-10)
    .style('fill','white')
    .style('stroke','black');

var lastIdx = 15;

var translate_array = [
[grid_x(0), grid_x(1), grid_x(2), grid_x(3), grid_x(4), grid_x(5), grid_x(6), grid_x(7), grid_x(8), grid_x(9), grid_x(10), grid_x(11), grid_x(12), grid_x(13), grid_x(14), grid_x(15)],
[grid_x(2), grid_x(3), grid_x(4), grid_x(5), grid_x(6), grid_x(7), grid_x(8), grid_x(9), grid_x(10), grid_x(11), grid_x(12), grid_x(13), grid_x(14), grid_x(15), grid_x(1), x(15)],
[grid_x(3), grid_x(4), grid_x(5), grid_x(6), grid_x(7), grid_x(8), grid_x(9), grid_x(10), grid_x(11), grid_x(12), grid_x(13), grid_x(14), grid_x(15), x(1), x(15)],
];

var up = function() {
    d3.selectAll('.trial').filter(function(d,i) { return i==lastIdx; })
        .transition()
            .delay(0)
            .duration(500)
            .attr('transform',function(d,i) { console.log('sliding'); return 'translate(50,0)';});
    lastIdx--;
};

      </script>
    </div>
  </body>
</html>
