<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="css/slide.css">
    <link type="text/css" rel="stylesheet" href="css/charts.css">
    <link type="text/css" rel="stylesheet" href="css/button.css">
    <script type="text/javascript" src="contrib/d3/d3.v3.min.js"></script>
  </head>
  <body>
    <div id="slide">
      <div id="header">
          <h1>Expt 2: Decoding Results</h1>
      </div>
      <div id="content-frame" class='with-both'>
          <div id="content" class="center">
              <span id="who">
                  <button class="first">Delay</button><button class="last active">Sample</button>
              </span>
              <div id="chart">
                  <!-- Plot gets inserted in here -->
              </div>
          </div>
      </div>
      <div id="footer">
          <h2>Emrich, Riggall, et al. (2013) J Neurosci</h2>
      </div>
    </div>
    <script type="text/javascript">

var width = 900;
    height = 600;

var margins = [80, 100, 50, 30], mb = margins[0], ml = margins[1], mt = margins[2], mr = margins[3];
var w = width - (ml + mr),
    h = height - (mb + mt);
var x = d3.scale.linear().range([0, w]).domain([0,12]);
var y = d3.scale.linear().range([h, 0]).domain([.40,.75]);
var yAxis = d3.svg.axis().scale(y).ticks(4).orient("left");

var bar_width = 100;

var cols = ['#E66101','#fe9929','#fec44f','#1A9641','#AAFF00','#E66101','#00FF00','#00FF55','#00FFAA','#E66101','#00AAFF','#5E3C99','#0000FF','#5500FF','#AA00FF','#FF00FF','#FF00AA','#FF0055'];

var samples = [
    [0.498207,0.496955,0.517367,0.551955,0.635866,0.658159,0.629534,0.564181,0.526029,0.542241,0.537448,0.501592,0.47424],
    [0.504783,0.506889,0.496459,0.521392,0.621927,0.600385,0.574418,0.574924,0.557465,0.501752,0.526831,0.50259,0.444557],
    [0.519112,0.5148,0.492547,0.508124,0.561761,0.576981,0.530623,0.545346,0.523568,0.520623,0.528786,0.536893,0.495505],
];

var delays = [
    [0.519493,0.504551,0.503795,0.502553,0.481486,0.4701,0.464607,0.480072,0.495641,0.524239,0.507696,0.503101,0.473222],
    [0.491314,0.464436,0.491296,0.498546,0.488767,0.491155,0.480318,0.489139,0.483704,0.519929,0.524603,0.50707,0.476092],
    [0.465126,0.462867,0.496464,0.533768,0.526132,0.5242,0.505889,0.499687,0.510501,0.53767,0.516503,0.49822,0.525178],
];

var svg = d3.select('#chart').append('svg:svg')
    .attr('class', 'chart')
    .attr("width", width)
    .attr("height", height);

var line = function() {};
    line = d3.svg.line()
        //.interpolate('monotone')
        .interpolate('linear')
        .x(function(d,i) { return x(i); })
        .y(function(d) { return y(d); });

    var plot = svg.append('g').attr('id','plot').attr('transform','translate('+ml+','+mt+')');

    var dataRegion = plot.append('g').attr('id','data-region');

    dataRegion.append('svg:rect')
            .style('fill','#E66101')
            .classed('bg',true)
            .attr('width',(x(1)-x(0)))
            .attr('height',h)
            .style('opacity',.5)
            .style('z-index',-5)
            .attr('x',function(d,i) { return x(4.5); })
            .attr('y',function(d) { return y(.75); });

    var trs = dataRegion.selectAll('.tr')
            .data(samples)
        .enter().append('svg:g')
                .style('opacity',0)
                .classed('tr',true);

    trs.append('svg:path')
                    .classed('data-line',true)
                   .style('fill','none')
                    .style('stroke-width',6)
                    .style('stroke',function(d,i) { return cols[i]; })
                    .attr('d',function(d,i) { return line(samples[i]); });

    // X-axis bounding boxes
//    trs.append('svg:rect')
//            .style('fill',function(d,i) { return cols[i]; })
//            .classed('bg',true)
//            .attr('width',(x(1)-x(0)))
//            .attr('height',h)
//            .style('z-index',-5)
//            .attr('x',function(d,i) { return x(i-.5); })
//            .attr('y',function(d) { return y(.75); });

var box = plot.selectAll('g.box')
    .data([-2,0,2,4,6,8,10,12,14,16,18,20,22])
.enter().append('svg:g')
    .classed('box',true);

    box.append('svg:rect')
            .style('fill','black')
            .style('stroke','black')
            .classed('left-wall',true)
            .attr('width',2)
            .attr('height',10)
            .attr('x',function(d,i) { return x(i); })
            .attr('y',function(d) { return y(.40); });

    box.append('svg:text')
            .text(function(d,i) { return d; })
            .attr('x',function(d,i) { return x(i); })
            .attr('y',function(d) { return y(.40)+32; })
                .on('click',function(d,i) { toggle(i+1);});

    // Add y-axis
    plot.append("g")
          .attr("class", "y axis")
          .call(yAxis);
    plot.select('.y.axis').append('svg:text')
        .attr('id','ylab')
        .text('Classifier Direction Sensitivity (AUC)')
        .style('text-anchor','middle')
        .attr('transform','translate(-65,'+(h/2)+') rotate(-90)');

    // Add x-axis
    plot.append("g")
          .attr("class", "x axis")
          .append('svg:line')
            .attr('x2',w)
            .attr('y1',h)
            .attr('y2',h)
            .style('stroke-width',3)
            .style('stroke','black');
    plot.select('.x.axis').append('svg:text')
        .text('Trial Time (s)').style('text-anchor','middle')
        .attr('transform','translate('+(w/2)+','+(h+70)+') ');

    // Sample Designator Box
    dataRegion.append('svg:rect')
            .style('fill','#777')
            .style('stroke','#000')
            .style('stroke-width','3px')
            .style('fill-opacity',1)
            .attr('width',(x(1)-x(0)))
            .attr('height',30)
            .attr('x',function(d,i) { return x(1); })
            .attr('y',function(d) { return y(.40)-30; });
    dataRegion.append('svg:text')
            .text('Sample')
            .attr('x',function(d,i) { return x(1.5); })
            .attr('y',function(d) { return y(.40)-40; });

    // Probe Designator Box
    dataRegion.append('svg:rect')
            .style('fill','#777')
            .style('stroke','#000')
            .style('fill-opacity',1)
            .style('stroke-width','3px')
            .attr('width',(x(2.5)-x(0)))
            .attr('height',30)
            .attr('x',function(d,i) { return x(6); })
            .attr('y',function(d) { return y(.40)-30; });
    dataRegion.append('svg:text')
            .text('Probe')
            .attr('x',function(d,i) { return x(7.25); })
            .attr('y',function(d) { return y(.40)-40; });



    // Chance
    plot.append('svg:line')
            .attr('id','chance-line')
            .style('stroke-dasharray','5,3')
            .style('stroke','black')
            .style('stroke-width','2px')
            .attr('x2',w)
            .attr('y1',y(.5))
            .attr('y2',y(.5));

    plot.append('svg:line')
            .attr('id','load1-line')
            .style('stroke','#E66101')
            .style('stroke-width','6px')
            .attr('x1',x(8))
            .attr('x2',x(9))
            .attr('y1',y(.7))
            .attr('y2',y(.7));
    plot.append('svg:text')
            .attr('id','load1-text')
            .text('Load 1')
            .attr('x',x(9.75))
            .attr('y',y(.695))
    plot.append('svg:text')
            .attr('id','load2-text')
            .text('Load 2')
            .style('opacity',0)
            .attr('x',x(9.75))
            .attr('y',y(.670))
    plot.append('svg:text')
            .attr('id','load3-text')
            .text('Load 3')
            .style('opacity',0)
            .attr('x',x(9.75))
            .attr('y',y(.645))

    plot.append('svg:line')
            .attr('id','load2-line')
            .style('stroke','#fe9929')
            .style('stroke-width','6px')
            .style('opacity',0)
            .attr('x1',x(8))
            .attr('x2',x(9))
            .attr('y1',y(.675))
            .attr('y2',y(.675));

    plot.append('svg:line')
            .attr('id','load3-line')
            .style('stroke','#fec44f')
            .style('stroke-width','6px')
            .attr('x1',x(8))
            .attr('x2',x(9))
            .style('opacity',0)
            .attr('y1',y(.65))
            .attr('y2',y(.65));

var visible = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
var toggle = function(n) {
    visible[n-1] = visible[n-1] == 1 ? 0 : 1;

    d3.selectAll('.tr')
        .filter(function(d,j) { return [n-1] == j;
            })
        .style('opacity',visible[n-1]);
}

toggle(1);

var myd = [];
var redraw = function(to) {
     switch(to) {
         case 'Sample':
             myd = samples;
             break;
         case 'Delay':
             myd = delays;
             break;
     }

     d3.selectAll('path.data-line').transition().duration(500).ease('linear')
         .attr('d',function(d,i) { return line(myd[i]); });
}

d3.selectAll("#who button")
        .data(['Delay','Sample'])
        .on("click",function(w) {
            redraw(w);
            d3.selectAll('#who button')
                .classed('active',function(d) { return d == w; });
                });

var step = 0;
var maxStep = 2;

var up = function() {
    prevSlide = typeof prevSlide !== 'undefined' ? prevSlide : false;

    if (step === 0) {
        if (prevSlide) window.parent.navigateBack();
    } else {
        step = step > 0 ? step-1 : 0;
        if (step == 0 ) {
            //d3.selectAll('#what button').filter(function(d,i) { return i!=0; }).style('display','none');
        }
    }
};

var down = function(nextSlide) {
    nextSlide = typeof nextSlide !== 'undefined' ? nextSlide : false;

    if (step < maxStep) {
        step = step < maxStep ? step+1 : maxStep;
        if (step == 1) {
            toggle(2);
            d3.select('#load2-line').style('opacity',1);
            d3.select('#load2-text').style('opacity',1);
        } else if (step == 2) {
            toggle(3);
            d3.select('#load3-line').style('opacity',1);
            d3.select('#load3-text').style('opacity',1);
        }
    } else {
        if (nextSlide) window.parent.navigateForward();
    }
};
// FIXME: Step through load results

    </script>
    <script type="text/javascript" src="js/my-slide.js"></script>
  </body>
</html>
